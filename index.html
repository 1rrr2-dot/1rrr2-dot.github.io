<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- æ‰‹æœºç«¯æ ¸å¿ƒé€‚é…æ ‡ç­¾ã€å¿…å¸¦ã€‘è‹¹æœ+å®‰å“é€šç”¨ï¼Œç¼ºä¸€ä¸å¯ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>å¤§å­¦ç”Ÿæ´»åŠ¨ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        /* é¡¶éƒ¨å°è‹±æ–‡å­—æ¯ - ä½ çš„è¦æ±‚ */
        .cute-top-text {
            text-align: center;
            font-family: "PingFang SC","å¾®è½¯é›…é»‘", sans-serif;
            font-size: 16px;
            color: rgb(100, 60, 170);
            font-weight: 600;
            margin: 0 0 8px 0;
            letter-spacing: 2px;
        }
        /* å…¨å±€æ ·å¼ - æ·¡ç´«è‰²æ¸å˜èƒŒæ™¯ */
        body {
            margin: 0;
            padding: 15px;
            min-height: 100vh;
            background: linear-gradient(rgb(230, 210, 255), rgb(200, 170, 240));
            font-family: "PingFang SC","å¾®è½¯é›…é»‘", sans-serif;
            box-sizing: border-box;
            font-size: 16px;
            /* æ‰‹æœºç‚¹å‡»æ— é«˜äº®ï¼Œä¼˜åŒ–ä½“éªŒ */
            -webkit-tap-highlight-color: transparent;
            tap-highlight-color: transparent;
        }
        /* ä¸»ä½“ç™½è‰²ç›’å­ - æ‰‹æœºé€‚é…å®½åº¦ */
        .container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            background: rgb(255, 255, 255);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 0 10px rgba(160, 120, 220, 0.2);
            box-sizing: border-box;
        }
        /* ç³»ç»Ÿå¤§æ ‡é¢˜ */
        h1 {
            text-align: center;
            color: rgb(90, 50, 150);
            margin-bottom: 15px;
            font-size: 20px;
            font-weight: bold;
        }
        /* è§’è‰²åˆ‡æ¢æŒ‰é’® - æ‰‹æœºç‚¹å‡»ä¼˜åŒ– é‡ç‚¹ï¼ */
        .role-switch {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .role-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            background: rgb(160, 120, 220);
            color: white;
            cursor: pointer;
            font-size: 16px;
            /* è§£å†³æ‰‹æœºæŒ‰é’®åŸç”Ÿæ ·å¼å†²çª */
            -webkit-appearance: none;
            appearance: none;
            touch-action: manipulation;
        }
        .role-btn.active {
            background: rgb(90, 50, 150);
        }
        /* è¡¨å•æ ·å¼ - æ‰‹æœºæ ¸å¿ƒé€‚é… é‡ç‚¹ï¼ */
        .form {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            padding: 15px 0;
            border-bottom: 1px solid rgb(230, 210, 255);
            margin-bottom: 15px;
        }
        .form input {
            padding: 10px 12px;
            border: 1px solid rgb(200, 170, 240);
            border-radius: 6px;
            width: calc(50% - 10px);
            min-width: 140px;
            font-size: 15px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            box-sizing: border-box;
        }
        /* å¥–åŠ±ç»†åˆ™è¾“å…¥æ¡†åŠ å®½ï¼Œæ–¹ä¾¿å¡«å†™ */
        .form input.reward-input {
            width: calc(100% - 10px);
        }
        /* æ‰€æœ‰æŒ‰é’®ç»Ÿä¸€æ ·å¼ - æ‰‹æœºç‚¹å‡»å¿…çµ é‡ç‚¹ï¼ */
        button {
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            background: rgb(160, 120, 220);
            color: #fff;
            cursor: pointer;
            font-size: 15px;
            -webkit-appearance: none;
            appearance: none;
            touch-action: manipulation;
            border: 0;
        }
        button:active {
            background: rgb(90, 50, 150);
        }
        /* è¡¨æ ¼æ»šåŠ¨å®¹å™¨ - æ‰‹æœºæ»‘åŠ¨ä¸æ»‘ é‡ç‚¹ï¼ */
        .table-container {
            overflow-x: auto;
            margin-bottom: 15px;
            width: 100%;
            /* è‹¹æœä¸“å±é¡ºæ»‘æ»šåŠ¨ */
            -webkit-overflow-scrolling: touch;
            overflow-scrolling: touch;
        }
        /* è¡¨æ ¼æ ·å¼ */
        table {
            width: 100%;
            min-width: 600px;
            border-collapse: collapse;
            text-align: center;
        }
        th, td {
            border: 1px solid rgb(200, 170, 240);
            padding: 8px 5px;
            font-size: 14px;
        }
        th {
            background: rgb(230, 210, 255);
            color: rgb(90, 50, 150);
            font-weight: bold;
        }
        tr:nth-child(even) {
            background: rgb(248, 245, 255);
        }
        /* æ¨¡å—æ˜¾éš */
        .module {
            display: none;
        }
        .module.active {
            display: block;
        }
        /* æç¤ºæ–‡å­— */
        .tips {
            text-align: center;
            color: rgb(120, 80, 180);
            margin: 8px 0;
            font-size: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- âœ… é¡¶éƒ¨å°è‹±æ–‡å­—æ¯ -->
        <div class="cute-top-text">xmr&lxt little creation</div>
        <!-- ç³»ç»Ÿæ ‡é¢˜ -->
        <h1>ğŸ¡ å¤§å­¦ç”Ÿæ´»åŠ¨ç®¡ç†ç³»ç»Ÿ</h1>
        <!-- è§’è‰²åˆ‡æ¢ -->
        <div class="role-switch">
            <button class="role-btn active" onclick="switchRole('student')">å­¦ç”Ÿç«¯</button>
            <button class="role-btn" onclick="switchRole('admin')">ç®¡ç†å‘˜ç«¯</button>
        </div>

        <!-- âœ… å­¦ç”Ÿç«¯ - æ‰‹æœºå¯æ­£å¸¸æŠ¥å/æŸ¥è®°å½•/å–æ¶ˆæŠ¥å -->
        <div class="module active" id="studentModule">
            <div class="form">
                <input type="text" id="stuId" placeholder="è¯·è¾“å…¥å­¦å·">
                <input type="text" id="stuName" placeholder="è¯·è¾“å…¥å§“å">
                <button onclick="queryMySign()">æŸ¥çœ‹æˆ‘çš„æŠ¥å</button>
            </div>
            <h3 class="tips">æ´»åŠ¨åˆ—è¡¨ï¼ˆç‚¹å‡»æŠ¥åï¼‰</h3>
            <div class="table-container">
                <table id="studentActivityTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>æ´»åŠ¨åç§°</th>
                            <th>æ—¶é—´</th>
                            <th>åœ°ç‚¹</th>
                            <th>å¥–åŠ±ç»†åˆ™</th>
                            <th>å‰©ä½™åé¢</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <h3 class="tips">æˆ‘çš„æŠ¥åè®°å½•</h3>
            <div class="table-container">
                <table id="mySignTable">
                    <thead>
                        <tr>
                            <th>æ´»åŠ¨åç§°</th>
                            <th>æ—¶é—´</th>
                            <th>å¥–åŠ±</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- âœ… ç®¡ç†å‘˜ç«¯ - æ‰‹æœºå¯æ­£å¸¸ç™»å½•/åŠ æ´»åŠ¨/å¡«å¥–åŠ±/åˆ æ´»åŠ¨/æŸ¥æŠ¥å -->
        <div class="module" id="adminModule">
            <div class="form">
                <input type="text" id="adminPwd" placeholder="ç®¡ç†å‘˜å¯†ç  123456">
                <button onclick="adminLogin()">ç™»å½•</button>
            </div>
            <div id="adminFunc" style="display: none;">
                <div class="form">
                    <input type="text" id="actName" placeholder="æ´»åŠ¨åç§°">
                    <input type="text" id="actTime" placeholder="æ—¶é—´ ä¾‹ï¼š2026-01-20">
                    <input type="text" id="actAddr" placeholder="æ´»åŠ¨åœ°ç‚¹">
                    <input type="number" id="actLimit" placeholder="äººæ•°é™åˆ¶">
                    <input type="text" id="actReward" class="reward-input" placeholder="å¥–åŠ±ç»†åˆ™ ä¾‹ï¼šç»¼æµ‹+2åˆ†/è¯ä¹¦">
                    <button onclick="addActivity()">æ·»åŠ æ´»åŠ¨</button>
                </div>
                <h3 class="tips">æ´»åŠ¨ç®¡ç†åˆ—è¡¨</h3>
                <div class="table-container">
                    <table id="adminActivityTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>æ´»åŠ¨åç§°</th>
                                <th>æ—¶é—´</th>
                                <th>åœ°ç‚¹</th>
                                <th>å¥–åŠ±ç»†åˆ™</th>
                                <th>æŠ¥å/ä¸Šé™</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <h3 class="tips">æŠ¥åè¯¦æƒ…ï¼ˆç‚¹å‡»æŸ¥çœ‹ï¼‰</h3>
                <div class="table-container">
                    <table id="signDetailTable">
                        <thead>
                            <tr>
                                <th>å­¦å·</th>
                                <th>å§“å</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€æ•°æ®
        let activities = [];
        let signRecords = [];
        let activityIdCounter = 1;

        // 1. è§’è‰²åˆ‡æ¢ - æ‰‹æœºç«¯æ­£å¸¸åˆ‡æ¢
        function switchRole(role) {
            document.getElementById('studentModule').className = role === 'student' ? 'module active' : 'module';
            document.getElementById('adminModule').className = role === 'admin' ? 'module active' : 'module';
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.className = btn.innerText.indexOf(role === 'student' ? 'å­¦ç”Ÿ' : 'ç®¡ç†') > -1 ? 'role-btn active' : 'role-btn';
            });
            renderStudentActivityTable();
        }

        // 2. ç®¡ç†å‘˜ç™»å½• - æ‰‹æœºç‚¹å‡»æ­£å¸¸è§¦å‘
        function adminLogin() {
            const pwd = document.getElementById('adminPwd').value.trim();
            if (pwd === '123456') {
                document.getElementById('adminFunc').style.display = 'block';
                renderAdminActivityTable();
                alert('ç®¡ç†å‘˜ç™»å½•æˆåŠŸï¼');
            } else {
                alert('å¯†ç é”™è¯¯ï¼Œé»˜è®¤å¯†ç ï¼š123456');
            }
        }

        // 3. ç®¡ç†å‘˜æ·»åŠ æ´»åŠ¨+å¥–åŠ±ç»†åˆ™ - æ‰‹æœºå¯æ­£å¸¸æ·»åŠ 
        function addActivity() {
            const name = document.getElementById('actName').value.trim();
            const time = document.getElementById('actTime').value.trim();
            const addr = document.getElementById('actAddr').value.trim();
            const limit = document.getElementById('actLimit').value.trim();
            const reward = document.getElementById('actReward').value.trim() || 'æ— å¥–åŠ±';

            if (!name || !time || !addr || !limit) {
                alert('è¯·å¡«å†™ï¼šæ´»åŠ¨åç§°ã€æ—¶é—´ã€åœ°ç‚¹ã€äººæ•°é™åˆ¶ï¼');
                return;
            }
            // æ·»åŠ æ´»åŠ¨æ•°æ®
            activities.push({
                id: 'act' + activityIdCounter++,
                name, time, addr, limit: Number(limit), reward, signCount: 0
            });
            // åˆ·æ–°è¡¨æ ¼
            renderAdminActivityTable();
            renderStudentActivityTable();
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('actName').value = '';
            document.getElementById('actTime').value = '';
            document.getElementById('actAddr').value = '';
            document.getElementById('actLimit').value = '';
            document.getElementById('actReward').value = '';
            alert('æ´»åŠ¨æ·»åŠ æˆåŠŸï¼');
        }

        // 4. å­¦ç”ŸæŠ¥åæ´»åŠ¨ - æ‰‹æœºç‚¹å‡»æŠ¥åæ­£å¸¸è§¦å‘
        function signActivity(actId) {
            const stuId = document.getElementById('stuId').value.trim();
            const stuName = document.getElementById('stuName').value.trim();
            if (!stuId || !stuName) {
                alert('è¯·å…ˆå¡«å†™ä½ çš„å­¦å·å’Œå§“åï¼');
                return;
            }
            const act = activities.find(item => item.id === actId);
            if (act.signCount >= act.limit) {
                alert('è¯¥æ´»åŠ¨åé¢å·²æ»¡ï¼');
                return;
            }
            const isSign = signRecords.some(item => item.stuId === stuId && item.actId === actId);
            if (isSign) {
                alert('ä½ å·²æŠ¥åè¯¥æ´»åŠ¨ï¼Œæ— éœ€é‡å¤æŠ¥åï¼');
                return;
            }
            // æ–°å¢æŠ¥åè®°å½•
            signRecords.push({ stuId, stuName, actId });
            act.signCount++;
            renderStudentActivityTable();
            renderAdminActivityTable();
            alert('æŠ¥åæˆåŠŸï¼');
        }

        // 5. å­¦ç”Ÿå–æ¶ˆæŠ¥å - æ‰‹æœºæ­£å¸¸è§¦å‘
        function cancelSign(actId) {
            const stuId = document.getElementById('stuId').value.trim();
            const idx = signRecords.findIndex(item => item.stuId === stuId && item.actId === actId);
            if (idx === -1) {
                alert('æœªæ‰¾åˆ°ä½ çš„æŠ¥åè®°å½•ï¼');
                return;
            }
            signRecords.splice(idx, 1);
            const act = activities.find(item => item.id === actId);
            act.signCount--;
            renderStudentActivityTable();
            renderAdminActivityTable();
            queryMySign();
            alert('å–æ¶ˆæŠ¥åæˆåŠŸï¼');
        }

        // 6. å­¦ç”ŸæŸ¥è¯¢æŠ¥åè®°å½• - æ‰‹æœºæ­£å¸¸æŸ¥çœ‹
        function queryMySign() {
            const stuId = document.getElementById('stuId').value.trim();
            if (!stuId) {
                alert('è¯·è¾“å…¥ä½ çš„å­¦å·ï¼');
                return;
            }
            const mySign = signRecords.filter(item => item.stuId === stuId);
            const tbody = document.getElementById('mySignTable').querySelector('tbody');
            tbody.innerHTML = '';
            if (mySign.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4">æš‚æ— æŠ¥åè®°å½•</td></tr>';
                return;
            }
            mySign.forEach(item => {
                const act = activities.find(a => a.id === item.actId);
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${act.name}</td><td>${act.time}</td><td>${act.reward}</td><td><button onclick="cancelSign('${act.id}')">å–æ¶ˆ</button></td>`;
                tbody.appendChild(tr);
            });
        }

        // 7. ç®¡ç†å‘˜æŸ¥çœ‹æŠ¥åè¯¦æƒ… - æ‰‹æœºæ­£å¸¸æŸ¥çœ‹
        function viewSignDetail(actId) {
            const signList = signRecords.filter(item => item.actId === actId);
            const tbody = document.getElementById('signDetailTable').querySelector('tbody');
            tbody.innerHTML = '';
            if (signList.length === 0) {
                tbody.innerHTML = '<tr><td colspan="2">æš‚æ— æŠ¥å</td></tr>';
                return;
            }
            signList.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${item.stuId}</td><td>${item.stuName}</td>`;
                tbody.appendChild(tr);
            });
        }

        // 8. ç®¡ç†å‘˜åˆ é™¤æ´»åŠ¨ - æ‰‹æœºæ­£å¸¸åˆ é™¤
        function deleteActivity(actId) {
            if (confirm('ç¡®å®šåˆ é™¤è¯¥æ´»åŠ¨ï¼ŸæŠ¥åè®°å½•ä¹Ÿä¼šåˆ é™¤ï¼')) {
                activities = activities.filter(item => item.id !== actId);
                signRecords = signRecords.filter(item => item.actId !== actId);
                renderAdminActivityTable();
                renderStudentActivityTable();
                alert('æ´»åŠ¨åˆ é™¤æˆåŠŸï¼');
            }
        }

        // æ¸²æŸ“å­¦ç”Ÿç«¯æ´»åŠ¨åˆ—è¡¨
        function renderStudentActivityTable() {
            const tbody = document.getElementById('studentActivityTable').querySelector('tbody');
            tbody.innerHTML = '';
            if (activities.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7">æš‚æ— æ´»åŠ¨ï¼Œæ•¬è¯·æœŸå¾…</td></tr>';
                return;
            }
            activities.forEach(act => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${act.id}</td>
                    <td>${act.name}</td>
                    <td>${act.time}</td>
                    <td>${act.addr}</td>
                    <td>${act.reward}</td>
                    <td>${act.limit - act.signCount}</td>
                    <td><button onclick="signActivity('${act.id}')">æŠ¥å</button></td>
                `;
                tbody.appendChild(tr);
            });
        }

        // æ¸²æŸ“ç®¡ç†å‘˜ç«¯æ´»åŠ¨åˆ—è¡¨
        function renderAdminActivityTable() {
            const tbody = document.getElementById('adminActivityTable').querySelector('tbody');
            tbody.innerHTML = '';
            if (activities.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7">æš‚æ— æ´»åŠ¨ï¼Œç‚¹å‡»æ·»åŠ </td></tr>';
                return;
            }
            activities.forEach(act => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${act.id}</td>
                    <td>${act.name}</td>
                    <td>${act.time}</td>
                    <td>${act.addr}</td>
                    <td>${act.reward}</td>
                    <td>${act.signCount}/${act.limit}</td>
                    <td>
                        <button onclick="viewSignDetail('${act.id}')">æŸ¥çœ‹æŠ¥å</button>
                        <button onclick="deleteActivity('${act.id}')">åˆ é™¤</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // åˆå§‹åŒ–åŠ è½½
        renderStudentActivityTable();
    </script>
</body>
</html>
